<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Stock Trading</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/styles.css">
    <style>
        /* This style ensures content appears below the fixed navbar */
        body {
            padding-top: 150px; /* Adjust this value if your navbar is taller or shorter */
        }
        /* New class for fixed-width buttons */
        .btn-fixed-width {
            width: 120px; /* Matching the max-width of the filter dropdown */
            min-width: 120px; /* Ensure it doesn't shrink below this */
        }
        /* Ensure the select element inside input-group does not expand excessively */
        #transactionTypeFilter {
            flex-grow: 0 !important; /* Override Bootstrap's flex-grow if present */
        }
        /* Added for better spacing of new sections */
        .market-card + .market-card {
            margin-top: 20px;
        }
        /* Style for individual stock items in market overview */
        .market-stock-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px dotted #e0e0e0;
        }
        .market-stock-item:last-child {
            border-bottom: none;
        }
        .market-stock-item span:first-child {
            font-weight: bold;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar navbar-expand-lg navbar-dark fixed-top"> <!-- Removed bg-dark class -->
            <div class="container">
                <a class="navbar-brand" href="#top">Stock Dashboard</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="#profile-section">Profile</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#market-overview-section">Market</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#portfolio-section">Portfolio</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#stocks-section">Stocks</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#transaction-history-section">Transactions</a>
                        </li>
                    </ul>
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item">
                            <button class="btn btn-outline-light" id="logoutButton">Logout</button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <main class="container">
        <section class="dashboard-header">
            <h1>Welcome, <span id="profileUsernameWelcome">User</span>!</h1>
            <p>Manage your profile, portfolio, and explore the market.</p>
        </section>

        <!-- Added d-flex and align-items-stretch to make columns equal height -->
        <div class="row d-flex align-items-stretch">
            <div class="col-md-6 mb-4 h-100"> <!-- Added h-100 -->
                <section id="profile-section" class="card shadow-sm h-100"> <!-- Added h-100 -->
                    <div class="card-header header-blue">
                        <h2 class="card-title mb-0">Your Profile</h2>
                    </div>
                    <div class="card-body">
                        <div class="profile-info mb-3">
                            <p><strong>Username:</strong> <span id="profileUsername">Loading...</span></p>
                            <p><strong>Email:</strong> <span id="profileEmail">Loading...</span></p>
                            <p><strong>First Name:</strong> <span id="profileFirstName">Loading...</span></p>
                            <p><strong>Last Name:</strong> <span id="profileLastName">Loading...</span></p>
                            <p><strong>Account Balance:</strong> <span id="accountBalance">Loading...</span></p>
                        </div>
                        <hr>
                        <h3>Update Profile</h3>
                        <form id="profileUpdateForm">
                            <div class="mb-3">
                                <label for="updateFirstName" class="form-label">First Name</label>
                                <input type="text" class="form-control" id="updateFirstName" required minlength="2">
                            </div>
                            <div class="mb-3">
                                <label for="updateLastName" class="form-label">Last Name</label>
                                <input type="text" class="form-control" id="updateLastName" required minlength="2">
                            </div>
                            <div class="mb-3">
                                <label for="updatePassword" class="form-label">New Password (optional)</label>
                                <input type="password" class="form-control" id="updatePassword" placeholder="Leave blank to keep current password" minlength="6">
                            </div>
                            <button type="submit" class="btn btn-primary">Update Profile</button>
                        </form>
                    </div>
                </section>
            </div>

            <div class="col-md-6 mb-4 h-100"> <!-- Added h-100 -->
                <section id="market-overview-section" class="card shadow-sm h-100"> <!-- Added h-100 -->
                    <div class="card-header header-blue">
                        <h2 class="card-title mb-0">Market Overview</h2>
                    </div>
                    <div class="card-body">
                        <div class="market-card p-3 mb-3">
                            <h3>Key Indices</h3>
                            <div class="row">
                                <div class="col-6">
                                    <p><strong>Nifty 50:</strong> <span id="niftyIndex">Loading...</span></p>
                                </div>
                                <div class="col-6">
                                    <p><strong>Sensex:</strong> <span id="sensexIndex">Loading...</span></p>
                                </div>
                            </div>
                            <p class="text-muted"><small>Prices updated live (placeholder)</small></p>
                        </div>

                        <div class="market-card p-3">
                            <h3>Popular Stocks</h3>
                            <div id="marketStocksContainer">
                                <!-- Stock data will be populated here by JavaScript -->
                                <p class="text-center text-muted">Loading popular stocks...</p>
                            </div>
                        </div>

                        <div class="market-card p-3">
                            <h3>Latest Market News</h3>
                            <ul>
                                <li><a href="#">Tech Giant announces new AI chip, stocks surge.</a></li>
                                <li><a href="#">Inflation data release impacts global bond markets.</a></li>
                                <li><a href="#">Oil prices stabilize after recent geopolitical tensions.</a></li>
                                <li><a href="#">Consumer spending report shows unexpected strength.</a></li>
                                <li><a href="#">Renewable energy sector poised for significant growth.</a></li>
                            </ul>
                        </div>


                    </div>
                </section>
            </div>
        </div>

        <section id="portfolio-section" class="card shadow-sm mb-4">
            <div class="card-header header-blue">
                <h2 class="card-title mb-0">Your Portfolio</h2>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="userPortfolioTable">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Company</th>
                                <th>Quantity</th>
                                <th>Avg. Cost</th>
                                <th>Current Price</th>
                                <th>Total Value</th>
                                <th>P/L (%)</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="8" class="text-center">Loading portfolio...</td></tr>
                        </tbody>
                    </table>
                </div>
                <p class="text-end mt-3">Total Portfolio Value: <strong>â‚¹<span id="totalPortfolioValue">0.00</span></strong></p>
            </div>
        </section>

        <section id="stocks-section" class="card shadow-sm mb-4">
            <div class="card-header header-blue">
                <h2 class="card-title mb-0">Available Stocks</h2>
            </div>
            <div class="card-body">
                <div class="mb-2"> <!-- Full width container for the search input -->
                    <input type="text" class="form-control" id="stockSearchInput" placeholder="Search by stock symbol or company name">
                </div>
                <div class="d-flex justify-content-between mb-3"> <!-- Container for search and clear buttons -->
                    <button class="btn btn-primary btn-sm btn-fixed-width" type="button" id="stockSearchButton">Search</button>
                    <button class="btn btn-outline-secondary btn-sm btn-fixed-width" type="button" id="clearStockSearchButton">Clear</button>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="availableStocksTable">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Company</th>
                                <th>Price</th>
                                <th>Change (%)</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="5" class="text-center">Loading stocks...</td></tr>
                        </tbody>
                    </table>
                </div>

                <nav aria-label="Available stocks pagination">
                    <ul class="pagination justify-content-center mt-3">
                        <li class="page-item" id="stocksPrevPage">
                            <a class="page-link" href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li class="page-item disabled"><span class="page-link" id="stocksPageInfo">Page 1 of 1</span></li>
                        <li class="page-item" id="stocksNextPage">
                            <a class="page-link" href="#" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                    <div class="d-flex justify-content-center mt-2">
                        <label for="stocksPerPage" class="me-2 mt-1">Stocks per page:</label>
                        <select class="form-select w-auto" id="stocksPerPage">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </nav>

            </div>
        </section>

        <section id="transaction-history-section" class="card shadow-sm mb-4">
            <div class="card-header header-blue">
                <h2 class="card-title mb-0">Transaction History</h2>
            </div>
            <div class="card-body">
                <div class="input-group mb-2"> <!-- Input group for search field and filter dropdown -->
                    <input type="text" class="form-control" id="transactionSearchInput" placeholder="Search by stock symbol or company">
                    <select class="form-select" id="transactionTypeFilter" style="max-width: 120px;"> <!-- Filter inside, small width -->
                        <option value="ALL" selected>All Types</option>
                        <option value="BUY">BUY</option>
                        <option value="SELL">SELL</option>
                    </select>
                </div>
                <div class="d-flex justify-content-between mb-3"> <!-- Container for search and clear buttons -->
                    <button class="btn btn-primary btn-sm btn-fixed-width" type="button" id="transactionSearchButton">Search</button>
                    <button class="btn btn-outline-secondary btn-sm btn-fixed-width" type="button" id="clearTransactionSearchButton">Clear</button>
                </div>

                <div class="table-responsive">
                    <table class="table table-striped table-hover" id="transactionHistoryTable">
                        <thead>
                            <tr>
                                <th>Date/Time</th>
                                <th>Symbol</th>
                                <th>Company</th>
                                <th>Type</th>
                                <th>Quantity</th>
                                <th>Price</th>
                                <th>Total Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr><td colspan="7" class="text-center">Loading transactions...</td></tr>
                        </tbody>
                    </table>
                </div>

                <nav aria-label="Transaction history pagination">
                    <ul class="pagination justify-content-center mt-3">
                        <li class="page-item" id="transactionsPrevPage">
                            <a class="page-link" href="#" aria-label="Previous">
                                <span aria-hidden="true">&laquo;</span>
                            </a>
                        </li>
                        <li class="page-item disabled"><span class="page-link" id="transactionsPageInfo">Page 1 of 1</span></li>
                        <li class="page-item" id="transactionsNextPage">
                            <a class="page-link" href="#" aria-label="Next">
                                <span aria-hidden="true">&raquo;</span>
                            </a>
                        </li>
                    </ul>
                    <div class="d-flex justify-content-center mt-2">
                        <label for="transactionsPerPage" class="me-2 mt-1">Transactions per page:</label>
                        <select class="form-select w-auto" id="transactionsPerPage">
                            <option value="5">5</option>
                            <option value="10" selected>10</option>
                            <option value="20">20</option>
                            <option value="50">50</option>
                        </select>
                    </div>
                </nav>

            </div>
        </section>
    </main>

    <div class="modal fade" id="buyStockModal" tabindex="-1" aria-labelledby="buyStockModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="buyStockModalLabel">Buy Stock: <span id="buyStockSymbol"></span></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="buyQuantityInput" class="form-label">Quantity</label>
              <input type="number" class="form-control" id="buyQuantityInput" min="1" value="1">
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="confirmBuyButton">Buy</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="sellStockModal" tabindex="-1" aria-labelledby="sellStockModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="sellStockModalLabel">Sell Stock: <span id="sellStockSymbol"></span></h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <div class="mb-3">
              <label for="sellQuantityInput" class="form-label">Quantity</label>
              <input type="number" class="form-control" id="sellQuantityInput" min="1" value="1">
              <small class="form-text text-muted" id="maxSellQuantity">You own: 0 shares</small>
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-danger" id="confirmSellButton">Sell</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="module" src="js/utils.js"></script>
    <script type="module" src="js/app.js"></script>
    <script type="module" src="js/dashboard.js"></script>
</body>
</html>